

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sphero_driver &mdash; sphero_ros 0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="sphero_ros 0.1 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../contents.html">sphero_ros 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sphero_driver</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c">#***********************************************************</span>
<span class="c">#* Software License Agreement (BSD License)</span>
<span class="c">#*</span>
<span class="c">#*  Copyright (c) 2012, Melonee Wise</span>
<span class="c">#*  All rights reserved.</span>
<span class="c">#*</span>
<span class="c">#*  Redistribution and use in source and binary forms, with or without</span>
<span class="c">#*  modification, are permitted provided that the following conditions</span>
<span class="c">#*  are met:</span>
<span class="c">#*</span>
<span class="c">#*   * Redistributions of source code must retain the above copyright</span>
<span class="c">#*     notice, this list of conditions and the following disclaimer.</span>
<span class="c">#*   * Redistributions in binary form must reproduce the above</span>
<span class="c">#*     copyright notice, this list of conditions and the following</span>
<span class="c">#*     disclaimer in the documentation and/or other materials provided</span>
<span class="c">#*     with the distribution.</span>
<span class="c">#*</span>
<span class="c">#*  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c">#*  &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c">#*  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<span class="c">#*  FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE</span>
<span class="c">#*  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<span class="c">#*  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,</span>
<span class="c">#*  BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<span class="c">#*  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<span class="c">#*  CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<span class="c">#*  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN</span>
<span class="c">#*  ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="c">#*  POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c">#***********************************************************</span>
<span class="c">#author: Melonee Wise</span>

<span class="kn">import</span> <span class="nn">bluetooth</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="c">#These are the message response code that can be return by Sphero.</span>
<span class="n">MRSP</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
  <span class="n">ORBOTIX_RSP_CODE_OK</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>           <span class="c">#Command succeeded</span>
  <span class="n">ORBOTIX_RSP_CODE_EGEN</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="c">#General, non-specific error</span>
  <span class="n">ORBOTIX_RSP_CODE_ECHKSUM</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>      <span class="c">#Received checksum failure</span>
  <span class="n">ORBOTIX_RSP_CODE_EFRAG</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>        <span class="c">#Received command fragment</span>
  <span class="n">ORBOTIX_RSP_CODE_EBAD_CMD</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>     <span class="c">#Unknown command ID</span>
  <span class="n">ORBOTIX_RSP_CODE_EUNSUPP</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>      <span class="c">#Command currently unsupported</span>
  <span class="n">ORBOTIX_RSP_CODE_EBAD_MSG</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>     <span class="c">#Bad message format</span>
  <span class="n">ORBOTIX_RSP_CODE_EPARAM</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>       <span class="c">#Parameter value(s) invalid</span>
  <span class="n">ORBOTIX_RSP_CODE_EEXEC</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>        <span class="c">#Failed to execute command</span>
  <span class="n">ORBOTIX_RSP_CODE_EBAD_DID</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>     <span class="c">#Unknown device ID</span>
  <span class="n">ORBOTIX_RSP_CODE_POWER_NOGOOD</span> <span class="o">=</span> <span class="mh">0x31</span><span class="p">,</span> <span class="c">#Voltage too low for refash operation</span>
  <span class="n">ORBOTIX_RSP_CODE_PAGE_ILLEGAL</span> <span class="o">=</span> <span class="mh">0x32</span><span class="p">,</span> <span class="c">#Illegal page number provided</span>
  <span class="n">ORBOTIX_RSP_CODE_FLASH_FAIL</span> <span class="o">=</span> <span class="mh">0x33</span><span class="p">,</span>   <span class="c">#Page did not reprogram correctly</span>
  <span class="n">ORBOTIX_RSP_CODE_MA_CORRUPT</span> <span class="o">=</span> <span class="mh">0x34</span><span class="p">,</span>   <span class="c">#Main application corrupt</span>
  <span class="n">ORBOTIX_RSP_CODE_MSG_TIMEOUT</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">)</span>  <span class="c">#Msg state machine timed out</span>


<span class="c">#ID codes for asynchronous packets</span>
<span class="n">IDCODE</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
  <span class="n">PWR_NOTIFY</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x01</span><span class="p">),</span>               <span class="c">#Power notifications</span>
  <span class="n">LEVEL1_DIAG</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>              <span class="c">#Level 1 Diagnostic response</span>
  <span class="n">DATA_STRM</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>                <span class="c">#Sensor data streaming</span>
  <span class="n">CONFIG_BLOCK</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x04</span><span class="p">),</span>             <span class="c">#Config block contents</span>
  <span class="n">SLEEP</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x05</span><span class="p">),</span>                    <span class="c">#Pre-sleep warning (10 sec)</span>
  <span class="n">MACRO_MARKERS</span> <span class="o">=</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x06</span><span class="p">),</span>             <span class="c">#Macro markers</span>
  <span class="n">COLLISION</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0x07</span><span class="p">))</span>                <span class="c">#Collision detected</span>

<span class="n">RECV</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
  <span class="n">ASYNC</span> <span class="o">=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0xff</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0xfe</span><span class="p">)],</span>
  <span class="n">SYNC</span> <span class="o">=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0xff</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="mh">0xff</span><span class="p">)])</span>


<span class="n">REQ</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
  <span class="n">WITH_RESPONSE</span> <span class="o">=</span><span class="p">[</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">],</span>
  <span class="n">WITHOUT_RESPONSE</span> <span class="o">=</span><span class="p">[</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">],</span>
  <span class="n">CMD_PING</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">],</span>
  <span class="n">CMD_VERSION</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">],</span>
  <span class="n">CMD_SET_BT_NAME</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">],</span>
  <span class="n">CMD_GET_BT_NAME</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">],</span>
  <span class="n">CMD_SET_AUTO_RECONNECT</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">],</span>
  <span class="n">CMD_GET_AUTO_RECONNECT</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">],</span>
  <span class="n">CMD_GET_PWR_STATE</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">],</span>
  <span class="n">CMD_SET_PWR_NOTIFY</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">],</span>
  <span class="n">CMD_SLEEP</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">],</span>
  <span class="n">CMD_GOTO_BL</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">],</span>
  <span class="n">CMD_RUN_L1_DIAGS</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">],</span>
  <span class="n">CMD_RUN_L2_DIAGS</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">],</span>
  <span class="n">CMD_CLEAR_COUNTERS</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">],</span>
  <span class="n">CMD_ASSIGN_COUNTER</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">],</span>
  <span class="n">CMD_POLL_TIMES</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">],</span>
  <span class="n">CMD_SET_HEADING</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">],</span>
  <span class="n">CMD_SET_STABILIZ</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">],</span>
  <span class="n">CMD_SET_ROTATION_RATE</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">],</span>
  <span class="n">CMD_SET_APP_CONFIG_BLK</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">],</span>
  <span class="n">CMD_GET_APP_CONFIG_BLK</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">],</span>
  <span class="n">CMD_SET_DATA_STRM</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">],</span>
  <span class="n">CMD_CFG_COL_DET</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">],</span>
  <span class="n">CMD_SET_RGB_LED</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">],</span>
  <span class="n">CMD_SET_BACK_LED</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">],</span>
  <span class="n">CMD_GET_RGB_LED</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">],</span>
  <span class="n">CMD_ROLL</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">],</span>
  <span class="n">CMD_BOOST</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">],</span>
  <span class="n">CMD_SET_RAW_MOTORS</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">],</span>
  <span class="n">CMD_SET_MOTION_TO</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">],</span>
  <span class="n">CMD_GET_CONFIG_BLK</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">],</span>
  <span class="n">CMD_SET_DEVICE_MODE</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">],</span>
  <span class="n">CMD_SET_CFG_BLOCK</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">],</span>
  <span class="n">CMD_GET_DEVICE_MODE</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">],</span>
  <span class="n">CMD_RUN_MACRO</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">],</span>
  <span class="n">CMD_SAVE_TEMP_MACRO</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">],</span>
  <span class="n">CMD_SAVE_MACRO</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">],</span>
  <span class="n">CMD_DEL_MACRO</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">],</span>
  <span class="n">CMD_INIT_MACRO_EXECUTIVE</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">],</span>
  <span class="n">CMD_ABORT_MACRO</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">],</span>
  <span class="n">CMD_GET_MACRO_STATUS</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">],</span>
  <span class="n">CMD_SET_MACRO_STATUS</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">])</span>

<span class="n">STRM_MASK1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
  <span class="n">GYRO_H_FILTERED</span>    <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
  <span class="n">GYRO_M_FILTERED</span>    <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
  <span class="n">GYRO_L_FILTERED</span>    <span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
  <span class="n">LEFT_EMF_FILTERED</span>  <span class="o">=</span> <span class="mh">0x00000020</span><span class="p">,</span>
  <span class="n">RIGHT_EMF_FILTERED</span> <span class="o">=</span> <span class="mh">0x00000040</span><span class="p">,</span>
  <span class="n">MAG_Z_FILTERED</span>     <span class="o">=</span> <span class="mh">0x00000080</span><span class="p">,</span>
  <span class="n">MAG_Y_FILTERED</span>     <span class="o">=</span> <span class="mh">0x00000100</span><span class="p">,</span>
  <span class="n">MAG_X_FILTERED</span>     <span class="o">=</span> <span class="mh">0x00000200</span><span class="p">,</span>
  <span class="n">GYRO_Z_FILTERED</span>    <span class="o">=</span> <span class="mh">0x00000400</span><span class="p">,</span>
  <span class="n">GYRO_Y_FILTERED</span>    <span class="o">=</span> <span class="mh">0x00000800</span><span class="p">,</span>
  <span class="n">GYRO_X_FILTERED</span>    <span class="o">=</span> <span class="mh">0x00001000</span><span class="p">,</span>
  <span class="n">ACCEL_Z_FILTERED</span>   <span class="o">=</span> <span class="mh">0x00002000</span><span class="p">,</span>
  <span class="n">ACCEL_Y_FILTERED</span>   <span class="o">=</span> <span class="mh">0x00004000</span><span class="p">,</span>
  <span class="n">ACCEL_X_FILTERED</span>   <span class="o">=</span> <span class="mh">0x00008000</span><span class="p">,</span>
  <span class="n">IMU_YAW_FILTERED</span>   <span class="o">=</span> <span class="mh">0x00010000</span><span class="p">,</span>
  <span class="n">IMU_ROLL_FILTERED</span>  <span class="o">=</span> <span class="mh">0x00020000</span><span class="p">,</span>
  <span class="n">IMU_PITCH_FILTERED</span> <span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
  <span class="n">LEFT_EMF_RAW</span>       <span class="o">=</span> <span class="mh">0x00200000</span><span class="p">,</span>
  <span class="n">RIGHT_EMF_RAW</span>      <span class="o">=</span> <span class="mh">0x00400000</span><span class="p">,</span>
  <span class="n">MAG_Z_RAW</span>          <span class="o">=</span> <span class="mh">0x00800000</span><span class="p">,</span>
  <span class="n">MAG_Y_RAW</span>          <span class="o">=</span> <span class="mh">0x01000000</span><span class="p">,</span>
  <span class="n">MAG_X_RAW</span>          <span class="o">=</span> <span class="mh">0x02000000</span><span class="p">,</span>
  <span class="n">GYRO_Z_RAW</span>         <span class="o">=</span> <span class="mh">0x04000000</span><span class="p">,</span>
  <span class="n">GYRO_Y_RAW</span>         <span class="o">=</span> <span class="mh">0x08000000</span><span class="p">,</span>
  <span class="n">GYRO_X_RAW</span>         <span class="o">=</span> <span class="mh">0x10000000</span><span class="p">,</span>
  <span class="n">ACCEL_Z_RAW</span>        <span class="o">=</span> <span class="mh">0x20000000</span><span class="p">,</span>
  <span class="n">ACCEL_Y_RAW</span>        <span class="o">=</span> <span class="mh">0x40000000</span><span class="p">,</span>
  <span class="n">ACCEL_X_RAW</span>        <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">)</span>

<span class="n">STRM_MASK2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
  <span class="n">QUATERNION_Q0</span>      <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>
  <span class="n">QUATERNION_Q1</span>      <span class="o">=</span> <span class="mh">0x40000000</span><span class="p">,</span>
  <span class="n">QUATERNION_Q2</span>      <span class="o">=</span> <span class="mh">0x20000000</span><span class="p">,</span>
  <span class="n">QUATERNION_Q3</span>      <span class="o">=</span> <span class="mh">0x10000000</span><span class="p">,</span>
  <span class="n">ODOM_X</span>             <span class="o">=</span> <span class="mh">0x08000000</span><span class="p">,</span>
  <span class="n">ODOM_Y</span>             <span class="o">=</span> <span class="mh">0x04000000</span><span class="p">,</span>
  <span class="n">ACCELONE</span>           <span class="o">=</span> <span class="mh">0x02000000</span><span class="p">,</span>
  <span class="n">VELOCITY_x</span>         <span class="o">=</span> <span class="mh">0x01000000</span><span class="p">,</span>
  <span class="n">VELOCITY_Y</span>         <span class="o">=</span> <span class="mh">0x00800000</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BTInterface</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_name</span> <span class="o">=</span> <span class="s">&#39;Sphero&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span> <span class="o">=</span> <span class="n">target_name</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">found_device</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">target_address</span> <span class="o">=</span> <span class="bp">None</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">sock</span> <span class="o">=</span> <span class="bp">None</span>

  <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Searching for devices....&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;....&quot;</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
      <span class="n">nearby_devices</span> <span class="o">=</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">discover_devices</span><span class="p">(</span><span class="n">lookup_names</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nearby_devices</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bdaddr</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">nearby_devices</span><span class="p">:</span>
          <span class="c">#look for a device name that starts with Sphero</span>
          <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">found_device</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_address</span> <span class="o">=</span> <span class="n">bdaddr</span>
            <span class="k">break</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">found_device</span><span class="p">:</span>
        <span class="k">break</span>


    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_address</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Found Sphero device with address: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_address</span><span class="p">))</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">No Sphero devices found.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">=</span><span class="n">bluetooth</span><span class="o">.</span><span class="n">BluetoothSocket</span><span class="p">(</span><span class="n">bluetooth</span><span class="o">.</span><span class="n">RFCOMM</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">bdaddr</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">bluetooth</span><span class="o">.</span><span class="n">btcommon</span><span class="o">.</span><span class="n">BluetoothError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Paired with Sphero.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">True</span>

  <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_bytes</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num_bytes</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="Sphero"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero">[docs]</a><span class="k">class</span> <span class="nc">Sphero</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_name</span> <span class="o">=</span> <span class="s">&#39;Sphero&#39;</span><span class="p">):</span>
    <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target_name</span> <span class="o">=</span> <span class="n">target_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bt</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mask_list</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_mask1</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_mask2</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">raw_data_buf</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_communication_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sync_callback_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sync_callback_queue</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bt</span> <span class="o">=</span> <span class="n">BTInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bt</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">True</span>

  <span class="k">def</span> <span class="nf">inc_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">&gt;</span> <span class="mh">0xff</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="k">def</span> <span class="nf">pack_cmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span> <span class="p">,</span><span class="n">cmd</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inc_seq</span><span class="p">()</span>
 <span class="c">#   print req + [self.seq] + [len(cmd)+1] + cmd</span>
    <span class="k">return</span> <span class="n">req</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">cmd</span>

  <span class="k">def</span> <span class="nf">data2hexstr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%02x</span><span class="s">&quot;</span><span class="o">%</span><span class="nb">ord</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>

  <span class="k">def</span> <span class="nf">create_mask_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask1</span><span class="p">,</span> <span class="n">mask2</span><span class="p">):</span>
    <span class="c">#save the mask</span>
    <span class="n">sorted_STRM1</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">STRM_MASK1</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c">#create a list containing the keys that are part of the mask</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mask_list1</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span>  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sorted_STRM1</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="n">mask1</span><span class="p">]</span>

    <span class="n">sorted_STRM2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">STRM_MASK2</span><span class="o">.</span><span class="n">iteritems</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c">#create a list containing the keys that are part of the mask</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mask_list2</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span>  <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sorted_STRM2</span> <span class="k">if</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="n">mask2</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mask_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_list1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mask_list2</span>


  <span class="k">def</span> <span class="nf">add_async_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback_type</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span><span class="p">[</span><span class="n">callback_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">callback</span>

  <span class="k">def</span> <span class="nf">remove_async_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback_type</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span><span class="p">[</span><span class="n">callback_type</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">add_sync_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback_type</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sync_callback_dict</span><span class="p">[</span><span class="n">callback_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">callback</span>

  <span class="k">def</span> <span class="nf">remove_sync_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callback_type</span><span class="p">):</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sync_callback_dict</span><span class="p">[</span><span class="n">callback_type</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">minn</span><span class="p">,</span> <span class="n">maxn</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">maxn</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">minn</span><span class="p">)</span>
    
<div class="viewcode-block" id="Sphero.ping"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.ping">[docs]</a>  <span class="k">def</span> <span class="nf">ping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Ping command is used to verify both a solid data link with the</span>
<span class="sd">    Client and that Sphero is awake and dispatching commands.</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_PING&#39;</span><span class="p">],[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.get_version"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.get_version">[docs]</a>  <span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Get Versioning command returns a whole slew of software and</span>
<span class="sd">    hardware information.</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_VERSION&#39;</span><span class="p">],[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_device_name"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_device_name">[docs]</a>  <span class="k">def</span> <span class="nf">set_device_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This assigned name is held internally and produced as part of the</span>
<span class="sd">    Get Bluetooth Info service below. Names are clipped at 48</span>
<span class="sd">    characters in length to support UTF-8 sequences; you can send</span>
<span class="sd">    something longer but the extra will be discarded. This field</span>
<span class="sd">    defaults to the Bluetooth advertising name.</span>

<span class="sd">    :param name: 48 character name.</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_BT_NAME&#39;</span><span class="p">],[</span><span class="n">name</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.get_bt_name"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.get_bt_name">[docs]</a>  <span class="k">def</span> <span class="nf">get_bt_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This returns the textual name (in ASCII) that the Bluetooth module</span>
<span class="sd">    advertises. It also returns the BTA Bluetooth Address or MAC ID</span>
<span class="sd">    for this device. Both values are returned in ASCII and have field</span>
<span class="sd">    widths of 16 characters, with unused trailing characters set to</span>
<span class="sd">    00h.</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_GET_BT_NAME&#39;</span><span class="p">],[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_auto_reconnect"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_auto_reconnect">[docs]</a>  <span class="k">def</span> <span class="nf">set_auto_reconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This configures the control of the Bluetooth module in its attempt</span>
<span class="sd">    to automatically reconnect with the last iPhone device. This is a</span>
<span class="sd">    courtesy behavior since the iPhone Bluetooth stack doesn&#39;t initiate</span>
<span class="sd">    automatic reconnection on its own.  The two parameters are simple:</span>
<span class="sd">    flag = 00h to disable or 01h to enable, and time = the number of</span>
<span class="sd">    seconds after power-up in which to enable auto reconnect mode. For</span>
<span class="sd">    example, if time = 30 then the module will be attempt reconnecting 30</span>
<span class="sd">    seconds after waking up.</span>

<span class="sd">    :param enable: 00h to disable or 01h to enable auto reconnecting.</span>
<span class="sd">    :param time: the number of seconds after power-up in which to\</span>
<span class="sd">    enable auto reconnect mode</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_AUTO_RECONNECT&#39;</span><span class="p">],[</span><span class="n">enable</span><span class="p">,</span><span class="n">time</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.get_auto_reconnect"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.get_auto_reconnect">[docs]</a>  <span class="k">def</span> <span class="nf">get_auto_reconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This returns the Bluetooth auto reconnect values as defined in the</span>
<span class="sd">    Set Auto Reconnect command.</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_GET_AUTO_RECONNECT&#39;</span><span class="p">],[]),</span> <span class="n">reponse</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.get_power_state"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.get_power_state">[docs]</a>  <span class="k">def</span> <span class="nf">get_power_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This returns the current power state and some additional</span>
<span class="sd">    parameters to the Client.</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_GET_PWR_STATE&#39;</span><span class="p">],[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_power_notify"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_power_notify">[docs]</a>  <span class="k">def</span> <span class="nf">set_power_notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This enables Sphero to asynchronously notify the Client</span>
<span class="sd">    periodically with the power state or immediately when the power</span>
<span class="sd">    manager detects a state change. Timed notifications arrive every 10</span>
<span class="sd">    seconds until they&#39;re explicitly disabled or Sphero is unpaired. The</span>
<span class="sd">    flag is as you would expect, 00h to disable and 01h to enable.</span>

<span class="sd">    :param enable: 00h to disable and 01h to enable power notifications.</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_PWR_NOTIFY&#39;</span><span class="p">],[</span><span class="n">enable</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.go_to_sleep"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.go_to_sleep">[docs]</a>  <span class="k">def</span> <span class="nf">go_to_sleep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">macro</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This puts Sphero to sleep immediately with two parameters: the</span>
<span class="sd">    first is the number of seconds after which it will automatically</span>
<span class="sd">    re-awaken. If set to zero, this feature is disabled. If non-zero then</span>
<span class="sd">    the MACRO parameter allows an optional system macro to be run upon</span>
<span class="sd">    wakeup. If this is set to zero, no macro is executed.</span>

<span class="sd">    :param time: number of seconds wait before auto re-awake.</span>
<span class="sd">    :param macro: macro number to run when re-awakened.</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SLEEP&#39;</span><span class="p">],[(</span><span class="n">time</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="n">time</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="n">macro</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.run_l1_diags"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.run_l1_diags">[docs]</a>  <span class="k">def</span> <span class="nf">run_l1_diags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a developer-level command to help diagnose aberrant</span>
<span class="sd">    behavior. Most system counters, process flags, and system states</span>
<span class="sd">    are decoded into human readable ASCII. There are two responses to</span>
<span class="sd">    this command: a Simple Response followed by a large async message</span>
<span class="sd">    containing the results of the diagnostic tests.</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_RUN_L1_DIAGS&#39;</span><span class="p">],[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.run_l2_diags"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.run_l2_diags">[docs]</a>  <span class="k">def</span> <span class="nf">run_l2_diags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a developers-only command to help diagnose aberrant</span>
<span class="sd">    behavior. It is much less impactful than the Level 1 command as it</span>
<span class="sd">    doesn&#39;t interfere with the current operation it simply returns a</span>
<span class="sd">    current set of statistics to the client.</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_RUN_L2_DIAGS&#39;</span><span class="p">],[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.clear_counters"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.clear_counters">[docs]</a>  <span class="k">def</span> <span class="nf">clear_counters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a developers-only command to clear the various system</span>
<span class="sd">    counters described in the level 2 diag.</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_CLEAR_COUNTERS&#39;</span><span class="p">],[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.assign_counter_value"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.assign_counter_value">[docs]</a>  <span class="k">def</span> <span class="nf">assign_counter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counter</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sphero contains a 32-bit counter that increments every millisecond</span>
<span class="sd">    when it&#39;s not in the Idle state. It has no absolute meaning and is</span>
<span class="sd">    reset for various reasons. This command assigns the counter a</span>
<span class="sd">    specific value for subsequent sampling.</span>

<span class="sd">    :param counter: value to set the counter to.</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_ASSIGN_COUNTER&#39;</span><span class="p">],[((</span><span class="n">counter</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">((</span><span class="n">counter</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">((</span><span class="n">counter</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="p">,(</span><span class="n">counter</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.poll_packet_times"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.poll_packet_times">[docs]</a>  <span class="k">def</span> <span class="nf">poll_packet_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This command helps the Client application profile the transmission</span>
<span class="sd">    and processing latencies in Sphero so that a relative</span>
<span class="sd">    synchronization of timebases can be performed. It allows the</span>
<span class="sd">    Client to reconcile time stamped messages from Sphero to its own</span>
<span class="sd">    time stamped events.</span>

<span class="sd">    The scheme is as follows: the Client sends the command with the</span>
<span class="sd">    Client Tx time (:math:`T_{1}`) filled in. Upon receipt of the packet, the</span>
<span class="sd">    command processor in Sphero copies that time into the response</span>
<span class="sd">    packet and places the current value of the millisecond counter</span>
<span class="sd">    into the Sphero Rx time field (:math:`T_{2}`). Just before the transmit</span>
<span class="sd">    engine streams it into the Bluetooth module, the Sphero Tx time</span>
<span class="sd">    value (:math:`T_{3}`)  is filled in. If the Client then records the time at</span>
<span class="sd">    which the response is received (:math:`T_{4}`) the relevant time segments can</span>
<span class="sd">    be computed from the four time stamps (:math:`T_{1}, T_{2}, T_{3}, T_{4}`):</span>

<span class="sd">    * The value offset represents the maximum-likelihood time offset\</span>
<span class="sd">      of the Client clock to Sphero&#39;s system clock.</span>
<span class="sd">        * offset :math:`= 1/2*[(T_{2} - T_{1}) + (T_{3}  - T_{4})]`</span>

<span class="sd">    * The value delay represents the round-trip delay between the\</span>
<span class="sd">      Client and Sphero:</span>
<span class="sd">        * delay :math:`= (T_{4} - T_{1}) - (T_{3} - T_{2})`</span>

<span class="sd">    :param time: client Tx time.</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_POLL_TIME&#39;</span><span class="p">],[((</span><span class="n">time</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">((</span><span class="n">time</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">((</span><span class="n">time</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">(</span><span class="n">time</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_heading"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_heading">[docs]</a>  <span class="k">def</span> <span class="nf">set_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This allows the client to adjust the orientation of Sphero by</span>
<span class="sd">    commanding a new reference heading in degrees, which ranges from 0</span>
<span class="sd">    to 359. You will see the ball respond immediately to this command</span>
<span class="sd">    if stabilization is enabled.</span>

<span class="sd">    :param heading: heading in degrees from 0 to 359 (motion will be\</span>
<span class="sd">    shortest angular distance to heading command)</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_HEADING&#39;</span><span class="p">],[(</span><span class="n">heading</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">),(</span><span class="n">heading</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_stablization"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_stablization">[docs]</a>  <span class="k">def</span> <span class="nf">set_stablization</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This turns on or off the internal stabilization of Sphero, in</span>
<span class="sd">    which the IMU is used to match the ball&#39;s orientation to its</span>
<span class="sd">    various set points. The flag value is as you would expect, 00h for</span>
<span class="sd">    off and 01h for on.</span>

<span class="sd">    :param enable: 00h for off and 01h for on (on by default).</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_STABILIZ&#39;</span><span class="p">],[</span><span class="n">enable</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_rotation_rate"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_rotation_rate">[docs]</a>  <span class="k">def</span> <span class="nf">set_rotation_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This allows you to control the rotation rate that Sphero will use</span>
<span class="sd">    to meet new heading commands. The commanded value is in units of</span>
<span class="sd">    0.784 degrees/sec. So, setting a value of c8h will set the</span>
<span class="sd">    rotation rate to 157 degrees/sec. A value of 255 jumps to the</span>
<span class="sd">    maximum and a value of 1 is the minimum.</span>

<span class="sd">    :param rate: rotation rate in units of 0.784degrees/sec (setting\</span>
<span class="sd">    this value will not cause the device to move only set the rate it\</span>
<span class="sd">    will move in other funcation calls).</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_ROTATION_RATE&#39;</span><span class="p">],[</span><span class="bp">self</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_app_config_blk"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_app_config_blk">[docs]</a>  <span class="k">def</span> <span class="nf">set_app_config_blk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_data</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This allows you to write a 32 byte block of data from the</span>
<span class="sd">    configuration block that is set aside for exclusive use by</span>
<span class="sd">    applications.</span>

<span class="sd">    :param app_data: block set aside for application.</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_APP_CONFIG_BLK&#39;</span><span class="p">],[((</span><span class="n">app_data</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">((</span><span class="n">app_data</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">((</span><span class="n">app_data</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">(</span><span class="n">app_data</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.get_app_config_blk"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.get_app_config_blk">[docs]</a>  <span class="k">def</span> <span class="nf">get_app_config_blk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This allows you to retrieve the application configuration block\</span>
<span class="sd">    that is set aside for exclusive use by applications.</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_GET_APP_CONFIG_BLK&#39;</span><span class="p">],</span> <span class="p">[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_data_strm"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_data_strm">[docs]</a>  <span class="k">def</span> <span class="nf">set_data_strm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_div</span><span class="p">,</span> <span class="n">sample_frames</span><span class="p">,</span> <span class="n">sample_mask1</span><span class="p">,</span> <span class="n">pcnt</span><span class="p">,</span> <span class="n">sample_mask2</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Currently the control system runs at 400Hz and because it&#39;s pretty</span>
<span class="sd">    unlikely you will want to see data at that rate, N allows you to</span>
<span class="sd">    divide that down. sample_div = 2 yields data samples at 200Hz,</span>
<span class="sd">    sample_div = 10, 40Hz, etc. Every data sample consists of a</span>
<span class="sd">    &quot;frame&quot; made up of the individual sensor values as defined by the</span>
<span class="sd">    sample_mask. The sample_frames value defines how many frames to</span>
<span class="sd">    collect in memory before the packet is emitted. In this sense, it</span>
<span class="sd">    controls the latency of the data you receive. Increasing</span>
<span class="sd">    sample_div and the number of bits set in sample_mask drive the</span>
<span class="sd">    required throughput. You should experiment with different values</span>
<span class="sd">    of sample_div, sample_frames and sample_mask to see what works</span>
<span class="sd">    best for you.</span>

<span class="sd">    :param sample_div: divisor of the maximum sensor sampling rate.</span>
<span class="sd">    :param sample_frames: number of sample frames emitted per packet.</span>
<span class="sd">    :param sample_mask1: bitwise selector of data sources to stream.</span>
<span class="sd">    :param pcnt: packet count (set to 0 for unlimited streaming).</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_DATA_STRM&#39;</span><span class="p">],</span> \
           <span class="p">[(</span><span class="n">sample_div</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="n">sample_div</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">(</span><span class="n">sample_frames</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="n">sample_frames</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">((</span><span class="n">sample_mask1</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> \
              <span class="p">((</span><span class="n">sample_mask1</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),((</span><span class="n">sample_mask1</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">(</span><span class="n">sample_mask1</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="n">pcnt</span><span class="p">,</span> <span class="p">((</span><span class="n">sample_mask2</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> \
              <span class="p">((</span><span class="n">sample_mask2</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),((</span><span class="n">sample_mask2</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="p">(</span><span class="n">sample_mask2</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">create_mask_list</span><span class="p">(</span><span class="n">sample_mask1</span><span class="p">,</span> <span class="n">sample_mask2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_mask1</span> <span class="o">=</span> <span class="n">sample_mask1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_mask2</span> <span class="o">=</span> <span class="n">sample_mask2</span>
    <span class="k">print</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
</div>
  <span class="k">def</span> <span class="nf">set_filtered_data_strm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_div</span><span class="p">,</span> <span class="n">sample_frames</span><span class="p">,</span> <span class="n">pcnt</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">mask1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mask2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">STRM_MASK1</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
      <span class="k">if</span> <span class="s">&#39;FILTERED&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
        <span class="n">mask1</span> <span class="o">=</span> <span class="n">mask1</span><span class="o">|</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">STRM_MASK2</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
        <span class="n">mask2</span> <span class="o">=</span> <span class="n">mask2</span><span class="o">|</span><span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_data_strm</span><span class="p">(</span><span class="n">sample_div</span><span class="p">,</span> <span class="n">sample_frames</span><span class="p">,</span> <span class="n">mask1</span><span class="p">,</span> <span class="n">pcnt</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">set_raw_data_strm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_div</span><span class="p">,</span> <span class="n">sample_frames</span><span class="p">,</span> <span class="n">pcnt</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">mask1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mask2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">STRM_MASK1</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
      <span class="k">if</span> <span class="s">&#39;RAW&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
        <span class="n">mask1</span> <span class="o">=</span> <span class="n">mask1</span><span class="o">|</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">STRM_MASK2</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
        <span class="n">mask2</span> <span class="o">=</span> <span class="n">mask2</span><span class="o">|</span><span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_data_strm</span><span class="p">(</span><span class="n">sample_div</span><span class="p">,</span> <span class="n">sample_frames</span><span class="p">,</span> <span class="n">mask1</span><span class="p">,</span> <span class="n">pcnt</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>


  <span class="k">def</span> <span class="nf">set_all_data_strm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_div</span><span class="p">,</span> <span class="n">sample_frames</span><span class="p">,</span> <span class="n">pcnt</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">mask1</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">mask2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">STRM_MASK1</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
        <span class="n">mask1</span> <span class="o">=</span> <span class="n">mask1</span><span class="o">|</span><span class="n">value</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">STRM_MASK2</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
        <span class="n">mask2</span> <span class="o">=</span> <span class="n">mask2</span><span class="o">|</span><span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_data_strm</span><span class="p">(</span><span class="n">sample_div</span><span class="p">,</span> <span class="n">sample_frames</span><span class="p">,</span> <span class="n">mask1</span><span class="p">,</span> <span class="n">pcnt</span><span class="p">,</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

<div class="viewcode-block" id="Sphero.config_collision_detect"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.config_collision_detect">[docs]</a>  <span class="k">def</span> <span class="nf">config_collision_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">Xt</span><span class="p">,</span> <span class="n">Xspd</span><span class="p">,</span> <span class="n">Yt</span><span class="p">,</span> <span class="n">Yspd</span><span class="p">,</span> <span class="n">ignore_time</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This command either enables or disables asynchronous message</span>
<span class="sd">    generation when a collision is detected.The Ignore Time parameter</span>
<span class="sd">    disables collision detection for a period of time after the async</span>
<span class="sd">    message is generated, preventing message overload to the</span>
<span class="sd">    client. The value is in 10 millisecond increments.</span>

<span class="sd">    :param method: Detection method type to use. Currently the only\</span>
<span class="sd">    method supported is 01h. Use 00h to completely disable this\</span>
<span class="sd">    service.</span>
<span class="sd">    :param Xt, Yt: An 8-bit settable threshold for the X (left/right)\</span>
<span class="sd">    and Y (front/back) axes of Sphero. A value of 00h disables the\</span>
<span class="sd">    contribution of that axis.</span>
<span class="sd">    :param Xspd,Yspd: An 8-bit settable speed value for the X and Y\</span>
<span class="sd">    axes. This setting is ranged by the speed, then added to Xt, Yt to\</span>
<span class="sd">    generate the final threshold value.</span>
<span class="sd">    :param ignore_time: An 8-bit post-collision dead time to prevent\</span>
<span class="sd">    retriggering; specified in 10ms increments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_CFG_COL_DET&#39;</span><span class="p">],[</span><span class="n">method</span><span class="p">,</span> <span class="n">Xt</span><span class="p">,</span> <span class="n">Xspd</span><span class="p">,</span> <span class="n">Yt</span><span class="p">,</span> <span class="n">Yspd</span><span class="p">,</span> <span class="n">ignore_time</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_rgb_led"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_rgb_led">[docs]</a>  <span class="k">def</span> <span class="nf">set_rgb_led</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This allows you to set the RGB LED color. The composite value is</span>
<span class="sd">    stored as the &quot;application LED color&quot; and immediately driven to</span>
<span class="sd">    the LED (if not overridden by a macro or orbBasic operation). If</span>
<span class="sd">    FLAG is true, the value is also saved as the &quot;user LED color&quot;</span>
<span class="sd">    which persists across power cycles and is rendered in the gap</span>
<span class="sd">    between an application connecting and sending this command.</span>

<span class="sd">    :param red: red color value.</span>
<span class="sd">    :param green: green color value.</span>
<span class="sd">    :param blue: blue color value.</span>
<span class="sd">    :param save: 01h for save (color is saved as &quot;user LED color&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_RGB_LED&#39;</span><span class="p">],[</span><span class="bp">self</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">red</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">green</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="n">save</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_back_led"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_back_led">[docs]</a>  <span class="k">def</span> <span class="nf">set_back_led</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This allows you to control the brightness of the back LED. The</span>
<span class="sd">    value does not persist across power cycles.</span>

<span class="sd">    :param brightness: 0-255, off-on (the blue LED on hemisphere of the Sphero).</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_SET_BACK_LED&#39;</span><span class="p">],[</span><span class="bp">self</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">brightness</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">)]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.get_rgb_led"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.get_rgb_led">[docs]</a>  <span class="k">def</span> <span class="nf">get_rgb_led</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This retrieves the &quot;user LED color&quot; which is stored in the config</span>
<span class="sd">    block (which may or may not be actively driven to the RGB LED).</span>

<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_GET_RGB_LED&#39;</span><span class="p">],[]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.roll"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.roll">[docs]</a>  <span class="k">def</span> <span class="nf">roll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This commands Sphero to roll along the provided vector. Both a</span>
<span class="sd">    speed and a heading are required; the latter is considered</span>
<span class="sd">    relative to the last calibrated direction. A state Boolean is also</span>
<span class="sd">    provided (on or off). The client convention for heading follows the 360</span>
<span class="sd">    degrees on a circle, relative to the ball: 0 is straight ahead, 90</span>
<span class="sd">    is to the right, 180 is back and 270 is to the left. The valid</span>
<span class="sd">    range is 0..359.</span>

<span class="sd">    :param speed: 0-255 value representing 0-max speed of the sphero.</span>
<span class="sd">    :param heading: heading in degrees from 0 to 359.</span>
<span class="sd">    :param state: 00h for off (braking) and 01h for on (driving).</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_ROLL&#39;</span><span class="p">],[</span><span class="bp">self</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">speed</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="p">(</span><span class="n">heading</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="n">heading</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">),</span> <span class="n">state</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.boost"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.boost">[docs]</a>  <span class="k">def</span> <span class="nf">boost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">heading</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This commands Sphero to meet the provided heading, disable</span>
<span class="sd">    stabilization and ramp the motors up to full-speed for a period of</span>
<span class="sd">    time. The Time parameter is the duration in tenths of a</span>
<span class="sd">    second. Setting it to zero enables constant boost until a Set</span>
<span class="sd">    Stabilization command is received.</span>

<span class="sd">    :param time: duration of boost in tenths of seconds.</span>
<span class="sd">    :param heading: the heading to travel while boosting.</span>
<span class="sd">    :param response: request response back from Sphero.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_BOOST&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">time</span><span class="p">,</span> <span class="p">(</span><span class="n">heading</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="n">heading</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.set_raw_motor_values"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.set_raw_motor_values">[docs]</a>  <span class="k">def</span> <span class="nf">set_raw_motor_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_mode</span><span class="p">,</span> <span class="n">l_power</span><span class="p">,</span> <span class="n">r_mode</span><span class="p">,</span> <span class="n">r_power</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This allows you to take over one or both of the motor output</span>
<span class="sd">    values, instead of having the stabilization system control</span>
<span class="sd">    them. Each motor (left and right) requires a mode (see below) and</span>
<span class="sd">    a power value from 0- 255. This command will disable stabilization</span>
<span class="sd">    if both modes aren&#39;t &quot;ignore&quot; so you&#39;ll need to re-enable it via</span>
<span class="sd">    CID 02h once you&#39;re done.</span>

<span class="sd">    :param mode: 0x00 - off, 0x01 - forward, 0x02 - reverse, 0x03 -\</span>
<span class="sd">    brake, 0x04 - ignored.</span>
<span class="sd">    :param power: 0-255 scalar value (units?).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pack_cmd</span><span class="p">(</span><span class="n">REQ</span><span class="p">[</span><span class="s">&#39;CMD_RAW_MOTORS&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">l_mode</span><span class="p">,</span> <span class="n">l_power</span><span class="p">,</span> <span class="n">r_mode</span><span class="p">,</span> <span class="n">r_power</span><span class="p">]),</span> <span class="n">response</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Sphero.send"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.send">[docs]</a>  <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Packets are sent from Client -&gt; Sphero in the following byte format::</span>

<span class="sd">      -------------------------------------------------------</span>
<span class="sd">      | SOP1 | SOP2 | DID | CID | SEQ | DLEN | &lt;data&gt; | CHK |</span>
<span class="sd">      -------------------------------------------------------</span>

<span class="sd">    * SOP1 - start packet 1 - Always 0xff. </span>
<span class="sd">    * SOP2 - start packet 2 - Set to 0xff when an acknowledgement is\</span>
<span class="sd">      expected, 0xfe otherwise.    </span>
<span class="sd">    * DID - Device ID</span>
<span class="sd">    * CID - Command ID</span>
<span class="sd">    * SEQ - Sequence Number - This client field is echoed in the\</span>
<span class="sd">      response for all synchronous commands (and ignored by Sphero\</span>
<span class="sd">      when SOP2 = 0xfe)</span>
<span class="sd">    * DLEN - Data</span>
<span class="sd">    * Length - Number of bytes through the end of the packet.</span>
<span class="sd">    * &lt;data&gt;</span>
<span class="sd">    * CHK - Checksum - The modulo 256 sum of all the bytes from the\</span>
<span class="sd">      DID through the end of the data payload, bit inverted (1&#39;s\</span>
<span class="sd">      complement).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#compute the checksum</span>
    <span class="c">#modulo 256 sum of data bit inverted</span>
    <span class="n">checksum</span> <span class="o">=~</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span>
    <span class="c">#if expecting response back from the sphero</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
      <span class="n">output</span> <span class="o">=</span> <span class="n">REQ</span><span class="p">[</span><span class="s">&#39;WITH_RESPONSE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="p">[</span><span class="n">checksum</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">output</span> <span class="o">=</span> <span class="n">REQ</span><span class="p">[</span><span class="s">&#39;WITHOUT_RESPONSE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="p">[</span><span class="n">checksum</span><span class="p">]</span>
    <span class="c">#pack the msg</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output</span><span class="p">)</span>
    <span class="c">#send the msg</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_communication_lock</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">bt</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</div>
  <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># this is larger than any single packet</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<div class="viewcode-block" id="Sphero.recv"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.recv">[docs]</a>  <span class="k">def</span> <span class="nf">recv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_bytes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Commands are acknowledged from the Sphero -&gt; Client in the</span>
<span class="sd">    following format::</span>

<span class="sd">      -------------------------------------------------</span>
<span class="sd">      |SOP1 | SOP2 | MSRP | SEQ | DLEN | &lt;data&gt; | CHK |</span>
<span class="sd">      -------------------------------------------------</span>

<span class="sd">    * SOP1 - Start Packet 1 - Always 0xff.</span>
<span class="sd">    * SOP2 - Start Packet 2 - Set to 0xff when this is an\</span>
<span class="sd">      acknowledgement, 0xfe otherwise.</span>
<span class="sd">    * MSRP - Message Response - This is generated by the message\</span>
<span class="sd">      decoder of the virtual device.</span>
<span class="sd">    * SEQ - Sequence Number - Echoed to the client when this is a\</span>
<span class="sd">      direct message response (set to 00h when SOP2 = FEh)</span>
<span class="sd">    * DLEN - Data Length - The number of bytes following through the\</span>
<span class="sd">      end of the packet</span>
<span class="sd">    * &lt;data&gt;</span>
<span class="sd">    * CHK - Checksum - - The modulo 256 sum of all the bytes from the\</span>
<span class="sd">      DID through the end of the data payload, bit inverted (1&#39;s\</span>
<span class="sd">      complement)</span>

<span class="sd">    Asynchronous Packets are sent from Sphero -&gt; Client in the</span>
<span class="sd">    following byte format::</span>

<span class="sd">      -------------------------------------------------------------</span>
<span class="sd">      |SOP1 | SOP2 | ID CODE | DLEN-MSB | DLEN-LSB | &lt;data&gt; | CHK |</span>
<span class="sd">      -------------------------------------------------------------</span>

<span class="sd">    * SOP1 - Start Packet 1 - Always 0xff.</span>
<span class="sd">    * SOP2 - Start Packet 2 - Set to 0xff when this is an</span>
<span class="sd">      acknowledgement, 0xfe otherwise.</span>
<span class="sd">    * ID CODE - ID Code - See the IDCODE dict</span>
<span class="sd">    * DLEN-MSB - Data Length MSB - The MSB number of bytes following\</span>
<span class="sd">      through the end of the packet</span>
<span class="sd">    * DLEN-LSB - Data Length LSB - The LSB number of bytes following\</span>
<span class="sd">      through the end of the packet</span>
<span class="sd">    * &lt;data&gt;</span>
<span class="sd">    * CHK - Checksum - - The modulo 256 sum of all the bytes from the\</span>
<span class="sd">      DID through the end of the data payload, bit inverted (1&#39;s\</span>
<span class="sd">      complement)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">shutdown</span><span class="p">:</span>
      <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_communication_lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_data_buf</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bt</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">num_bytes</span><span class="p">)</span>
      <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_data_buf</span>
      <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">RECV</span><span class="p">[</span><span class="s">&#39;SYNC&#39;</span><span class="p">]:</span>
          <span class="k">print</span> <span class="s">&quot;got response packet&quot;</span>
          <span class="c"># response packet</span>
          <span class="n">data_length</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
          <span class="k">if</span> <span class="n">data_length</span><span class="o">+</span><span class="mi">5</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">data_packet</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:(</span><span class="mi">5</span><span class="o">+</span><span class="n">data_length</span><span class="p">)]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="mi">5</span><span class="o">+</span><span class="n">data_length</span><span class="p">):]</span>
            <span class="k">print</span> <span class="s">&quot;Response packet&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2hexstr</span><span class="p">(</span><span class="n">data_packet</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">data</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">RECV</span><span class="p">[</span><span class="s">&#39;ASYNC&#39;</span><span class="p">]:</span>
          <span class="n">data_length</span> <span class="o">=</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
          <span class="k">if</span> <span class="n">data_length</span><span class="o">+</span><span class="mi">5</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">data_packet</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:(</span><span class="mi">5</span><span class="o">+</span><span class="n">data_length</span><span class="p">)]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="mi">5</span><span class="o">+</span><span class="n">data_length</span><span class="p">):]</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="c"># the remainder of the packet isn&#39;t long enough</span>
            <span class="k">break</span>
          <span class="k">if</span> <span class="n">data_packet</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;DATA_STRM&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;DATA_STRM&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span><span class="p">[</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;DATA_STRM&#39;</span><span class="p">]](</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_data_strm</span><span class="p">(</span><span class="n">data_packet</span><span class="p">,</span> <span class="n">data_length</span><span class="p">))</span>
          <span class="k">elif</span> <span class="n">data_packet</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;COLLISION&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;COLLISION&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span><span class="p">[</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;COLLISION&#39;</span><span class="p">]](</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_collision_detect</span><span class="p">(</span><span class="n">data_packet</span><span class="p">,</span> <span class="n">data_length</span><span class="p">))</span>
          <span class="k">elif</span> <span class="n">data_packet</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;PWR_NOTIFY&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;PWR_NOTIFY&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_async_callback_dict</span><span class="p">[</span><span class="n">IDCODE</span><span class="p">[</span><span class="s">&#39;PWR_NOTIFY&#39;</span><span class="p">]](</span><span class="bp">self</span><span class="o">.</span><span class="n">parse_pwr_notify</span><span class="p">(</span><span class="n">data_packet</span><span class="p">,</span> <span class="n">data_length</span><span class="p">))</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;got a packet that isn&#39;t streaming&quot;</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Bad SOF : &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2hexstr</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">raw_data_buf</span><span class="o">=</span><span class="n">data</span>
</div>
<div class="viewcode-block" id="Sphero.parse_pwr_notify"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.parse_pwr_notify">[docs]</a>  <span class="k">def</span> <span class="nf">parse_pwr_notify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_length</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The data payload of the async message is 1h bytes long and</span>
<span class="sd">    formatted as follows::</span>

<span class="sd">      --------</span>
<span class="sd">      |State |</span>
<span class="sd">      --------</span>

<span class="sd">    The power state byte: </span>
<span class="sd">      * 01h = Battery Charging, </span>
<span class="sd">      * 02h = Battery OK,</span>
<span class="sd">      * 03h = Battery Low, </span>
<span class="sd">      * 04h = Battery Critical</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="s">&#39;B&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">:]))[</span><span class="mi">0</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Sphero.parse_collision_detect"><a class="viewcode-back" href="../api.html#sphero_driver.Sphero.parse_collision_detect">[docs]</a>  <span class="k">def</span> <span class="nf">parse_collision_detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_length</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The data payload of the async message is 10h bytes long and</span>
<span class="sd">    formatted as follows::</span>

<span class="sd">      -----------------------------------------------------------------</span>
<span class="sd">      |X | Y | Z | AXIS | xMagnitude | yMagnitude | Speed | Timestamp |</span>
<span class="sd">      -----------------------------------------------------------------</span>

<span class="sd">    * X, Y, Z - Impact components normalized as a signed 16-bit\</span>
<span class="sd">    value. Use these to determine the direction of collision event. If\</span>
<span class="sd">    you don&#39;t require this level of fidelity, the two Magnitude fields\</span>
<span class="sd">    encapsulate the same data in pre-processed format.</span>
<span class="sd">    * Axis - This bitfield specifies which axes had their trigger\</span>
<span class="sd">    thresholds exceeded to generate the event. Bit 0 (01h) signifies\</span>
<span class="sd">    the X axis and bit 1 (02h) the Y axis.</span>
<span class="sd">    * xMagnitude - This is the power that crossed the programming\</span>
<span class="sd">    threshold Xt + Xs.</span>
<span class="sd">    * yMagnitude - This is the power that crossed the programming\</span>
<span class="sd">    threshold Yt + Ys.</span>
<span class="sd">    * Speed - The speed of Sphero when the impact was detected.</span>
<span class="sd">    * Timestamp - The millisecond timer value at the time of impact;\</span>
<span class="sd">    refer to the documentation of CID 50h and 51h to make sense of\</span>
<span class="sd">    this value.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">output</span><span class="o">=</span><span class="p">{}</span>
    
    <span class="n">output</span><span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">[</span><span class="s">&#39;Y&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">[</span><span class="s">&#39;Z&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">[</span><span class="s">&#39;Axis&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">[</span><span class="s">&#39;xMagnitude&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">[</span><span class="s">&#39;yMagnitude&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">[</span><span class="s">&#39;Speed&#39;</span><span class="p">],</span> <span class="n">output</span><span class="p">[</span><span class="s">&#39;Timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="s">&#39;&gt;hhhbhhbI&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">:]))</span>
    <span class="k">return</span> <span class="n">output</span>
</div>
  <span class="k">def</span> <span class="nf">parse_data_strm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">data_length</span><span class="p">):</span>
    <span class="n">output</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">data_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
      <span class="n">unpack</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="s">&#39;&gt;h&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">:]))</span>
      <span class="n">output</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mask_list</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">output</span>
    <span class="k">return</span> <span class="n">output</span>



  <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../contents.html">sphero_ros 0.1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Melonee Wise.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>